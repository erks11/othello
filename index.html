<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>おせろ</title>
  </head>
  <body>
    <style>
      #tables {
        display: flex;
      }
      #othello {
        border-collapse: collapse;
        background-color: #008080;
        border: 10px solid black;
        border-top-style: none;
        border-left-style: none;
      }
      #battle-status {
        background-color: lavender;
        width: 200px;
        height: 240px;
      }
      th {
        background-color: black;
        color: blanchedalmond;
        font-size: xx-small;
      }
      #othello td {
        border: solid 1px black;
        width: 24px;
        height: 24px;
      }
      #othello td.active {
        background: lightseagreen;
      }
      #othello div {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        margin: 1px auto;
      }
      div.black-stone {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: solid 1px black;
        background-color: black;
        margin: 1px auto;
      }
      div.white-stone {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: solid 1px black;
        background-color: #fff8dc;
        margin: 1px auto;
      }
    </style>
    <div id="tables">
      <table id="othello">
        <tr>
          <th></th>
          <th>a</th>
          <th>b</th>
          <th>c</th>
          <th>d</th>
          <th>e</th>
          <th>f</th>
          <th>g</th>
          <th>h</th>
        </tr>
        <tr>
          <th>1</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>2</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>3</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>4</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div class="white-stone"></div></td>
          <td><div class="black-stone"></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>5</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div class="black-stone"></div></td>
          <td><div class="white-stone"></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>6</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>7</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
        <tr>
          <th>8</th>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
          <td><div></div></td>
        </tr>
      </table>

      <table id="battle-status">
        <tr>
          <td>○わたし</td>
        </tr>
        <tr>
          <td>の番です</td>
        </tr>
        <tr>
          <td>
            <button>reset</button>
            <button>GiveUp</button>
          </td>
        </tr>
        <tr>
          <td>●あなた</td>
        </tr>
      </table>
    </div>
    <script>
      var list = document.querySelectorAll("#othello td div");
      for (var i = 0; i < list.length; i++) {
        list[i].addEventListener(
          "click",
          (function(i2) {
            return function(e) {
              if (list[i2].classList.contains("black-stone")) {
                list[i2].classList.add("white-stone");
                list[i2].classList.remove("black-stone");
              } else if (list[i2].classList.contains("white-stone")) {
                list[i2].classList.remove("white-stone");
              } else {
                list[i2].classList.add("black-stone");
              }
            };
          })(i),
          false
        );
      }

      var td_list = document.querySelectorAll("#othello td");
      var statusArr = [
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 1, 2, 0, 0, 0],
        [0, 0, 0, 2, 1, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0]
      ];

      // 黒が自分とする
      var mycolor = 2;
      // 白が1　黒が2
      // 64マス全てに対して、置けるかどうか判断したい
      for (var i = 0; i < statusArr.length; i++) {
        for (var k = 0; k < statusArr[i].length; k++) {
          // すでに置いてあったらスルーする
          if (statusArr[i][k] != 0) {
            continue;
          }
          // 置けるかどうか判断する
          if (judgeActive(mycolor, i, k)) {
            td_list[8 * k + i].classList.add("active");
          }
        }
      }
      // 周囲8マスをみてる
      function judgeActive(mycolor, i, k) {
        for (var i2 = i - 1; i2 <= i + 1; i2++) {
          for (var k2 = k - 1; k2 <= k + 1; k2++) {
            // 自分自身なのでスルー
            if (i2 === i && k2 === k) {
              continue;
            }
            let res = searchOneway({ x: i, y: k }, i2 - i, k2 - k, mycolor);
            if (res) {
              return true;
            }
          }
        }
        return false;
      }

      function searchOneway(cood, xv, yv, mycolor) {
        let result = false;
        let arr = [];
        let x = cood.x;
        let y = cood.y;
        // 斜めの場合
        if (xv != 0 && yv != 0) {
          let new_cood = { x: x, y: y };
          while (
            new_cood.x < statusArr.length - 1 &&
            new_cood.x >= 0 &&
            (new_cood.y < statusArr.length - 1 && new_cood.y >= 0)
          ) {
            new_cood.x += xv;
            new_cood.y += yv;
            if (new_cood.x > 0 && new_cood.y > 0) {
              let stat = statusArr[new_cood.x][new_cood.y];
              arr.push(stat);
              // 隣が空白か、自分の色だったら抜ける
              if (stat == 0 || stat == mycolor) {
                break;
              }
            }
          }
          // arr[0]が空白じゃなくて、自分の色でもない
          // arr[1]以上にずっと空白がないかつ自分の色がいる
          if (arr.length >= 2 && arr[arr.length - 1] === mycolor) {
            result = true;
          }
          return result;
        }
        // 縦方向の場合
        else if (xv === 0) {
          for (let k = y + yv; k < statusArr[i].length - 1 && k >= 0; k += yv) {
            if (k > 0) {
              let stat = statusArr[x][k];
              arr.push(statusArr[x][k]);
              // 隣が空白か、自分の色だったら抜ける
              if (stat == 0 || stat == mycolor) {
                break;
              }
            } else {
              break;
            }
          }
          // arr[0]が空白じゃなくて、自分の色でもない
          // arr[1]以上にずっと空白がないかつ自分の色がいる
          if (arr.length >= 2 && arr[arr.length - 1] === mycolor) {
            result = true;
          }

          return result;
        }
        // 横方向の場合
        else if (yv === 0) {
          for (let i = x + xv; i < statusArr.length - 1 && i >= 0; i += xv) {
            if (i > 0) {
              let stat = statusArr[i][y];
              arr.push(statusArr[i][y]);
              // 隣が空白か、自分の色だったら抜ける
              if (stat == 0 || stat == mycolor) {
                break;
              }
            } else {
              break;
            }
          }

          // arr[0]が空白じゃなくて、自分の色でもない
          // arr[1]以上にずっと空白がないかつ自分の色がいる
          if (arr.length >= 2 && arr[arr.length - 1] === mycolor) {
            result = true;
          }
          return result;
        } else {
        }
      }
    </script>
  </body>
</html>
